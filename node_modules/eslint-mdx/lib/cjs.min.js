"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("tslib"),r=require("espree"),n=e(require("path")),s=e(require("remark-mdx")),o=e(require("remark-parse")),i=e(require("unified")),a=["@typescript-eslint/parser","babel-eslint"],p=["JSXElement","JSXFragment"],u=function(e){return p.includes(e.type)},c=function(e){if(e){if("string"==typeof e&&(e=require(e)),"object"==typeof e&&(e="parseForESLint"in e&&e.parseForESLint||"parse"in e&&e.parse),"function"!=typeof e)throw new TypeError("Invalid custom parser for `eslint-mdx`: "+e);return[e]}for(var t=[r.parse],n=0,s=a;n<s.length;n++){var o=s[n];try{var i=require(o),p="parseForESLint"in i?i.parseForESLint:i.parse;p&&t.unshift(p)}catch(e){}}return t},l=function(e){var r=e.start.offset,n=e.end.offset;return{range:[r,n],loc:t.__assign({},e),start:r,end:n}};function f(e,r,n){if(!e||!e.loc||!e.range)return e;Object.entries(e).forEach((function(t){var s=t[0],o=t[1];o&&(Array.isArray(o)?e[s]=o.map((function(e){return f(e,r,n)})):e[s]=f(o,r,n))}));var s=e.loc,o=s.start,i=s.end,a=e.range,p=a[0]+n,u=a[1]+n;return t.__assign(t.__assign({},e),{start:p,end:u,range:[p,u],loc:{start:{line:r+o.line,column:o.column},end:{line:r+i.line,column:i.column}}})}var x=function(e){return e&&e[e.length-1]},m=function(e,t){return t.every((function(t){return t in e}))},h="(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*"+("(?:[^\"'=<>`\\u0000-\\u0020]+|'[^']*'|\"[^\"]*\"|"+"{.*}".replace(".","[\0-ï¿¿]")+")")+")?)",d="<[A-Za-z]*[A-Za-z0-9\\.\\-]*"+h+"*\\s*>",_="<\\s*\\/[A-Za-z]*[A-Za-z0-9\\.\\-]*\\s*>",E="<[A-Za-z]*[A-Za-z0-9\\.\\-]*"+h+"*\\s*\\/?>",v="\x3c!----\x3e|\x3c!--(?:-?[^>-])(?:-?[^-])*--\x3e",g=new RegExp("^(?:"+d+")$"),y=new RegExp("^(?:"+_+")$"),S=new RegExp("^(?:"+d+"[\\s\\S]*"+_+")$"),T=new RegExp("^(?:"+E+")$"),N=new RegExp("^(?:"+v+")$"),O=new RegExp("(\x3c!---*)([\\s\\S]*?)(-*--\x3e)"),A=new RegExp("(\x3c!---*)([\\s\\S]*?)(-*--\x3e)","g"),L=function(e){return g.test(e)},b=function(e){return y.test(e)},P=function(e){return N.test(e)},R=function(e){return S.test(e)},C=function(e){return T.test(e)},w=function(){function e(e){var t=e.code,r=e.enter;this.code=t,this._enter=r}return e.prototype.combineLeftJsxNodes=function(e){var t=e[0].position.start,r=x(e).position.end;return{type:"jsx",data:e[0].data,value:this.code.slice(t.offset,r.offset),position:{start:e[0].position.start,end:x(e).position.end}}},e.prototype.combineJsxNodes=function(e,t){var r=this,n=0,s=[],o=e.length;return e.reduce((function(e,i,a){if("jsx"===i.type){var p=i.value;if(L(p))n++,s.push(i);else{if(b(p))n--,s.push(i);else if(P(p)||C(p)||R(p))s.push(i);else try{var u=I.normalizeJsxNode(i,t);s.push.apply(s,Array.isArray(u)?u:[u])}catch(e){var c=i.position.start;throw Object.assign(new SyntaxError("unknown jsx node: "+JSON.stringify(p)),{lineNumber:c.line,column:c.column,index:c.offset})}if(!n){var l=s.findIndex((function(e){return L(e.value)}));-1===l?e.push.apply(e,s):(e.push.apply(e,s.slice(0,l)),e.push(r.combineLeftJsxNodes(s.slice(l)))),s.length=0}}}else n?s.push(i):e.push(i);return a===o-1&&s.length>0&&e.push(r.combineLeftJsxNodes(s)),e}),[])},e.prototype.traverse=function(e,t){var r=this;if(e){var n=e.children;if(n){var s=e;(n=e.children=this.combineJsxNodes(n,s)).forEach((function(e){return r.traverse(e,s)}))}this._enter(e,t)}},e}(),J=function(e,t){return new w(t).traverse(e)},z=i().use(o).freeze(),F=z().use(s).freeze(),j=["body","comments","tokens"],X=["export","import","jsx"],G=["column","lineNumber"],M=[".mdx"],k=[".md"],q={comment:!0,ecmaFeatures:{jsx:!0},ecmaVersion:(new Date).getUTCFullYear(),sourceType:"module",tokens:!0,filePath:"__placeholder__.mdx",loc:!0,range:!0},Z="<$>".length,$=function(){function e(){this._options=q,this.parse=this.parse.bind(this),this.parseForESLint=this.parseForESLint.bind(this)}return e.prototype.normalizeJsxNode=function(e,r,n){void 0===n&&(n=this._options);var s=e.value;if("jsx"!==e.type||P(s))return e;if(O.exec(s)){var o=[],i=e.position.start,a=i.line,p=i.column,u=i.offset;Object.assign(e,{data:t.__assign(t.__assign({},e.data),{jsxType:"JSXElementWithHTMLComments",comments:o,inline:!!r&&"root"!==r.type}),value:s.replace(A,(function(e,t,r,n,i){var c=i+e.length,l=s.slice(0,i).split("\n"),f=s.slice(0,c).split("\n"),m="{/"+"*".repeat(t.length-2)+r+"*".repeat(n.length-2)+"/}",h=l.length-1,d=f.length-1;return o.push({fixed:m,loc:{start:{line:a+h,column:x(l).length+(h?0:p-1),offset:u+i},end:{line:a+d,column:x(f).length+(d?0:p-1),offset:u+c}},origin:e}),m}))})}return this._normalizeJsxNodes(e,n)},e.prototype.parse=function(e,t){return this.parseForESLint(e,t).ast},e.prototype.parseForESLint=function(e,r){var s=this,o=n.extname(r.filePath),i=M.concat(r.extensions||[]).includes(o),a=k.concat(r.markdownExtensions||[]).includes(o);if(!i&&!a)return this._eslintParse(e,r);var p=(i?F:z).parse(e);return this._ast=t.__assign(t.__assign({},l(p.position)),{type:"Program",sourceType:r.sourceType||"module",body:[],comments:[],tokens:[]}),this._services={JSXElementsWithHTMLComments:[]},i&&J(p,{code:e,enter:function(e,t){if(X.includes(e.type)){var n=s.normalizeJsxNode(e,t,r);(n=Array.isArray(n)?n:[n]).forEach((function(e){return s._nodeToAst(e,r)}))}}}),{ast:this._ast,services:this._services}},e.prototype._eslintParse=function(e,t){var r,n;this._parsers&&t.parser===this._options.parser||(this._parsers=c(t.parser)),t.filePath&&this._options!==t&&Object.assign(this._options,t);for(var s=0,o=this._parsers;s<o.length;s++){var i=o[s];try{r=i(e,this._options);break}catch(e){n||(n=e)}}if(!r&&n)throw n;return"ast"in r&&r.ast?r:{ast:r}},e.prototype._normalizeJsxNodes=function(e,t){var r,n=e.value;try{r=this._eslintParse("<$>"+n+"</$>",t).ast}catch(t){if(m(t,G)){var s=e.position.start;throw"index"in t?t.index+=s.offset-Z:"pos"in t&&(t.pos+=s.offset-Z),t.column=t.lineNumber>1?t.column:t.column+s.column-Z,t.lineNumber+=s.line-1,t}return e}var o=r.body[0].expression;if(!u(o)||o.children.length<=1)return e;var i=e.position.start,a=i.line,p=i.offset;return o.children.reduce((function(t,r){if(!u(r))return t;var s=r.start,o=r.end,i=r.loc,c=void 0===i?{start:{column:s,line:1},end:{column:o,line:1}}:i,l=c.start,f=c.end,x=r.range,m=void 0===x?[s,o]:x,h=a+l.line-1,d=a+f.line-1,_=m[0]-Z,E=m[1]-Z;return t.push({type:"jsx",data:t.length>0?null:e.data,value:n.slice(_,E),position:{start:{line:h,column:a===h?l.column-Z:l.column,offset:p+_},end:{line:d,column:a===h?f.column-Z:f.column,offset:p+E}}}),t}),[])},e.prototype._nodeToAst=function(e,t){var r=this;e.data&&"JSXElementWithHTMLComments"===e.data.jsxType&&this._services.JSXElementsWithHTMLComments.push(e);var n=e.value,s=l(e.position),o=s.loc,i=s.start,a=s.end;if(P(n)){var p=O.exec(n)[2];this._ast.comments.push({type:"Block",value:p,loc:o,range:[i,a]})}else{var u,c=o.start.line-1;try{u=this._eslintParse(n,t).ast}catch(e){throw m(e,G)&&(e.index+=i,e.column=e.lineNumber>1?e.column:e.column+o.start.column,e.lineNumber+=c),e}var x=i-u.range[0];j.forEach((function(e){var t;return(t=r._ast[e]).push.apply(t,u[e].map((function(e){return f(e,c,x)})))}))}},e}(),I=new $,D=I.parse,W=I.parseForESLint;exports.AST_PROPS=j,exports.CLOSE_TAG_REGEX=y,exports.COMMENT_CONTENT_REGEX=O,exports.COMMENT_CONTENT_REGEX_GLOBAL=A,exports.COMMENT_REGEX=N,exports.DEFAULT_EXTENSIONS=M,exports.DEFAULT_PARSER_OPTIONS=q,exports.ES_NODE_TYPES=X,exports.FALLBACK_PARSERS=a,exports.JSX_TYPES=p,exports.LOC_ERROR_PROPERTIES=G,exports.MARKDOWN_EXTENSIONS=k,exports.OPEN_CLOSE_TAG_REGEX=S,exports.OPEN_TAG_REGEX=g,exports.Parser=$,exports.SELF_CLOSING_TAG_REGEX=T,exports.Traverse=w,exports.closeTag=_,exports.comment=v,exports.commentClose="(-*--\x3e)",exports.commentContent="(\x3c!---*)([\\s\\S]*?)(-*--\x3e)",exports.commentOpen="(\x3c!---*)",exports.first=function(e){return e&&e[0]},exports.hasProperties=m,exports.isCloseTag=b,exports.isComment=P,exports.isJsxNode=u,exports.isOpenCloseTag=R,exports.isOpenTag=L,exports.isSelfClosingTag=C,exports.last=x,exports.mdProcessor=z,exports.mdxProcessor=F,exports.normalizeParser=c,exports.normalizePosition=l,exports.openTag=d,exports.parse=D,exports.parseForESLint=W,exports.parser=I,exports.restoreNodeLocation=f,exports.selfClosingTag=E,exports.traverse=J;
