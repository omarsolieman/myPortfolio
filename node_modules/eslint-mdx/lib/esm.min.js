import{__assign as e}from"tslib";import{parse as t}from"espree";import n from"path";import r from"remark-mdx";import s from"remark-parse";import o from"unified";var i=["@typescript-eslint/parser","babel-eslint"],a=["JSXElement","JSXFragment"],u=function(e){return a.includes(e.type)},c=function(e){if(e){if("string"==typeof e&&(e=require(e)),"object"==typeof e&&(e="parseForESLint"in e&&e.parseForESLint||"parse"in e&&e.parse),"function"!=typeof e)throw new TypeError("Invalid custom parser for `eslint-mdx`: "+e);return[e]}for(var n=[t],r=0,s=i;r<s.length;r++){var o=s[r];try{var a=require(o),u="parseForESLint"in a?a.parseForESLint:a.parse;u&&n.unshift(u)}catch(e){}}return n},l=function(t){var n=t.start.offset,r=t.end.offset;return{range:[n,r],loc:e({},t),start:n,end:r}};function p(t,n,r){if(!t||!t.loc||!t.range)return t;Object.entries(t).forEach((function(e){var s=e[0],o=e[1];o&&(Array.isArray(o)?t[s]=o.map((function(e){return p(e,n,r)})):t[s]=p(o,n,r))}));var s=t.loc,o=s.start,i=s.end,a=t.range,u=a[0]+r,c=a[1]+r;return e(e({},t),{start:u,end:c,range:[u,c],loc:{start:{line:n+o.line,column:o.column},end:{line:n+i.line,column:i.column}}})}var f=function(e){return e&&e[0]},m=function(e){return e&&e[e.length-1]},h=function(e,t){return t.every((function(t){return t in e}))},d="(?:\\s+[a-zA-Z_:][a-zA-Z0-9:._-]*(?:\\s*=\\s*"+("(?:[^\"'=<>`\\u0000-\\u0020]+|'[^']*'|\"[^\"]*\"|"+"{.*}".replace(".","[\0-ï¿¿]")+")")+")?)",v="<[A-Za-z]*[A-Za-z0-9\\.\\-]*"+d+"*\\s*>",x="<\\s*\\/[A-Za-z]*[A-Za-z0-9\\.\\-]*\\s*>",y="<[A-Za-z]*[A-Za-z0-9\\.\\-]*"+d+"*\\s*\\/?>",g="\x3c!----\x3e|\x3c!--(?:-?[^>-])(?:-?[^-])*--\x3e",_="(\x3c!---*)",E="(-*--\x3e)",b="(\x3c!---*)([\\s\\S]*?)(-*--\x3e)",S=new RegExp("^(?:"+v+")$"),w=new RegExp("^(?:"+x+")$"),J=new RegExp("^(?:"+v+"[\\s\\S]*"+x+")$"),N=new RegExp("^(?:"+y+")$"),A=new RegExp("^(?:"+g+")$"),L=new RegExp("(\x3c!---*)([\\s\\S]*?)(-*--\x3e)"),z=new RegExp("(\x3c!---*)([\\s\\S]*?)(-*--\x3e)","g"),j=function(e){return S.test(e)},T=function(e){return w.test(e)},F=function(e){return A.test(e)},k=function(e){return J.test(e)},P=function(e){return N.test(e)},Z=function(){function e(e){var t=e.code,n=e.enter;this.code=t,this._enter=n}return e.prototype.combineLeftJsxNodes=function(e){var t=e[0].position.start,n=m(e).position.end;return{type:"jsx",data:e[0].data,value:this.code.slice(t.offset,n.offset),position:{start:e[0].position.start,end:m(e).position.end}}},e.prototype.combineJsxNodes=function(e,t){var n=this,r=0,s=[],o=e.length;return e.reduce((function(e,i,a){if("jsx"===i.type){var u=i.value;if(j(u))r++,s.push(i);else{if(T(u))r--,s.push(i);else if(F(u)||P(u)||k(u))s.push(i);else try{var c=D.normalizeJsxNode(i,t);s.push.apply(s,Array.isArray(c)?c:[c])}catch(e){var l=i.position.start;throw Object.assign(new SyntaxError("unknown jsx node: "+JSON.stringify(u)),{lineNumber:l.line,column:l.column,index:l.offset})}if(!r){var p=s.findIndex((function(e){return j(e.value)}));-1===p?e.push.apply(e,s):(e.push.apply(e,s.slice(0,p)),e.push(n.combineLeftJsxNodes(s.slice(p)))),s.length=0}}}else r?s.push(i):e.push(i);return a===o-1&&s.length>0&&e.push(n.combineLeftJsxNodes(s)),e}),[])},e.prototype.traverse=function(e,t){var n=this;if(e){var r=e.children;if(r){var s=e;(r=e.children=this.combineJsxNodes(r,s)).forEach((function(e){return n.traverse(e,s)}))}this._enter(e,t)}},e}(),$=function(e,t){return new Z(t).traverse(e)},R=o().use(s).freeze(),X=R().use(r).freeze(),C=["body","comments","tokens"],O=["export","import","jsx"],H=["column","lineNumber"],M=[".mdx"],W=[".md"],q={comment:!0,ecmaFeatures:{jsx:!0},ecmaVersion:(new Date).getUTCFullYear(),sourceType:"module",tokens:!0,filePath:"__placeholder__.mdx",loc:!0,range:!0},I="<$>".length,B=function(){function t(){this._options=q,this.parse=this.parse.bind(this),this.parseForESLint=this.parseForESLint.bind(this)}return t.prototype.normalizeJsxNode=function(t,n,r){void 0===r&&(r=this._options);var s=t.value;if("jsx"!==t.type||F(s))return t;if(L.exec(s)){var o=[],i=t.position.start,a=i.line,u=i.column,c=i.offset;Object.assign(t,{data:e(e({},t.data),{jsxType:"JSXElementWithHTMLComments",comments:o,inline:!!n&&"root"!==n.type}),value:s.replace(z,(function(e,t,n,r,i){var l=i+e.length,p=s.slice(0,i).split("\n"),f=s.slice(0,l).split("\n"),h="{/"+"*".repeat(t.length-2)+n+"*".repeat(r.length-2)+"/}",d=p.length-1,v=f.length-1;return o.push({fixed:h,loc:{start:{line:a+d,column:m(p).length+(d?0:u-1),offset:c+i},end:{line:a+v,column:m(f).length+(v?0:u-1),offset:c+l}},origin:e}),h}))})}return this._normalizeJsxNodes(t,r)},t.prototype.parse=function(e,t){return this.parseForESLint(e,t).ast},t.prototype.parseForESLint=function(t,r){var s=this,o=n.extname(r.filePath),i=M.concat(r.extensions||[]).includes(o),a=W.concat(r.markdownExtensions||[]).includes(o);if(!i&&!a)return this._eslintParse(t,r);var u=(i?X:R).parse(t);return this._ast=e(e({},l(u.position)),{type:"Program",sourceType:r.sourceType||"module",body:[],comments:[],tokens:[]}),this._services={JSXElementsWithHTMLComments:[]},i&&$(u,{code:t,enter:function(e,t){if(O.includes(e.type)){var n=s.normalizeJsxNode(e,t,r);(n=Array.isArray(n)?n:[n]).forEach((function(e){return s._nodeToAst(e,r)}))}}}),{ast:this._ast,services:this._services}},t.prototype._eslintParse=function(e,t){var n,r;this._parsers&&t.parser===this._options.parser||(this._parsers=c(t.parser)),t.filePath&&this._options!==t&&Object.assign(this._options,t);for(var s=0,o=this._parsers;s<o.length;s++){var i=o[s];try{n=i(e,this._options);break}catch(e){r||(r=e)}}if(!n&&r)throw r;return"ast"in n&&n.ast?n:{ast:n}},t.prototype._normalizeJsxNodes=function(e,t){var n,r=e.value;try{n=this._eslintParse("<$>"+r+"</$>",t).ast}catch(t){if(h(t,H)){var s=e.position.start;throw"index"in t?t.index+=s.offset-I:"pos"in t&&(t.pos+=s.offset-I),t.column=t.lineNumber>1?t.column:t.column+s.column-I,t.lineNumber+=s.line-1,t}return e}var o=n.body[0].expression;if(!u(o)||o.children.length<=1)return e;var i=e.position.start,a=i.line,c=i.offset;return o.children.reduce((function(t,n){if(!u(n))return t;var s=n.start,o=n.end,i=n.loc,l=void 0===i?{start:{column:s,line:1},end:{column:o,line:1}}:i,p=l.start,f=l.end,m=n.range,h=void 0===m?[s,o]:m,d=a+p.line-1,v=a+f.line-1,x=h[0]-I,y=h[1]-I;return t.push({type:"jsx",data:t.length>0?null:e.data,value:r.slice(x,y),position:{start:{line:d,column:a===d?p.column-I:p.column,offset:c+x},end:{line:v,column:a===d?f.column-I:f.column,offset:c+y}}}),t}),[])},t.prototype._nodeToAst=function(e,t){var n=this;e.data&&"JSXElementWithHTMLComments"===e.data.jsxType&&this._services.JSXElementsWithHTMLComments.push(e);var r=e.value,s=l(e.position),o=s.loc,i=s.start,a=s.end;if(F(r)){var u=L.exec(r)[2];this._ast.comments.push({type:"Block",value:u,loc:o,range:[i,a]})}else{var c,f=o.start.line-1;try{c=this._eslintParse(r,t).ast}catch(e){throw h(e,H)&&(e.index+=i,e.column=e.lineNumber>1?e.column:e.column+o.start.column,e.lineNumber+=f),e}var m=i-c.range[0];C.forEach((function(e){var t;return(t=n._ast[e]).push.apply(t,c[e].map((function(e){return p(e,f,m)})))}))}},t}(),D=new B,U=D.parse,V=D.parseForESLint;export{C as AST_PROPS,w as CLOSE_TAG_REGEX,L as COMMENT_CONTENT_REGEX,z as COMMENT_CONTENT_REGEX_GLOBAL,A as COMMENT_REGEX,M as DEFAULT_EXTENSIONS,q as DEFAULT_PARSER_OPTIONS,O as ES_NODE_TYPES,i as FALLBACK_PARSERS,a as JSX_TYPES,H as LOC_ERROR_PROPERTIES,W as MARKDOWN_EXTENSIONS,J as OPEN_CLOSE_TAG_REGEX,S as OPEN_TAG_REGEX,B as Parser,N as SELF_CLOSING_TAG_REGEX,Z as Traverse,x as closeTag,g as comment,E as commentClose,b as commentContent,_ as commentOpen,f as first,h as hasProperties,T as isCloseTag,F as isComment,u as isJsxNode,k as isOpenCloseTag,j as isOpenTag,P as isSelfClosingTag,m as last,R as mdProcessor,X as mdxProcessor,c as normalizeParser,l as normalizePosition,v as openTag,U as parse,V as parseForESLint,D as parser,p as restoreNodeLocation,y as selfClosingTag,$ as traverse};
